rule Malware_Signature_Detection {
    meta:
        description = "Detects common malware signatures in memory"
        author = "Memory Forensics Tool"
        severity = "high"
        category = "malware"

    strings:
        $mz_header = { 4D 5A }
        $elf_header = { 7F 45 4C 46 }
        $reverse_shell = "sh -i >& /dev/tcp/" nocase
        $bind_shell = "nc -lvp" nocase
        $wget_download = "wget http" nocase
        $curl_download = "curl -o" nocase
        $base64_decode = "base64 -d" nocase
        $suspicious_chmod = "chmod 777" nocase
        $suspicious_chown = "chown root" nocase

    condition:
        any of them
}

rule Malware_Code_Injection {
    meta:
        description = "Detects code injection patterns"
        author = "Memory Forensics Tool"
        severity = "critical"
        category = "malware"

    strings:
        $ptrace = "ptrace" nocase
        $process_vm_writev = "process_vm_writev" nocase
        $process_vm_readv = "process_vm_readv" nocase
        $ld_preload = "LD_PRELOAD" nocase
        $ld_library_path = "LD_LIBRARY_PATH" nocase
        $dlopen = "dlopen" nocase
        $mmap_exec = { 50 52 4F 54 5F 45 58 45 43 }

    condition:
        2 of them
}

rule Malware_Rootkit_Indicators {
    meta:
        description = "Detects rootkit indicators in memory"
        author = "Memory Forensics Tool"
        severity = "critical"
        category = "malware"

    strings:
        $hidden_module = "/dev/shm/" nocase
        $proc_hide = "/proc/self/" nocase
        $kernel_module = ".ko" nocase
        $sys_call_table = "sys_call_table" nocase
        $init_module = "init_module" nocase
        $delete_module = "delete_module" nocase

    condition:
        any of them
}

rule Malware_Persistence_Mechanism {
    meta:
        description = "Detects persistence mechanisms"
        author = "Memory Forensics Tool"
        severity = "high"
        category = "malware"

    strings:
        $cron_entry = "/etc/cron" nocase
        $systemd_service = "/etc/systemd/system/" nocase
        $rc_local = "/etc/rc.local" nocase
        $bashrc = ".bashrc" nocase
        $profile = ".profile" nocase
        $init_d = "/etc/init.d/" nocase

    condition:
        any of them
}

rule Malware_Network_Activity {
    meta:
        description = "Detects suspicious network activity patterns"
        author = "Memory Forensics Tool"
        severity = "medium"
        category = "malware"

    strings:
        $socket_call = "socket(" nocase
        $connect_call = "connect(" nocase
        $bind_call = "bind(" nocase
        $listen_call = "listen(" nocase
        $raw_socket = "SOCK_RAW" nocase
        $packet_socket = "AF_PACKET" nocase

    condition:
        3 of them
}