rule Vulnerability_Buffer_Overflow {
    meta:
        description = "Detects potential buffer overflow patterns"
        severity = "critical"
        tags = "critical"
        cve = "Multiple"

    strings:
        $overflow1 = "strcpy(" nocase
        $overflow2 = "sprintf(" nocase
        $overflow3 = "gets(" nocase
        $overflow4 = "scanf(%s)" nocase

    condition:
        any of them
}

rule Vulnerability_Use_After_Free {
    meta:
        description = "Detects use-after-free vulnerability patterns"
        severity = "critical"
        tags = "critical"

    strings:
        $uaf1 = "free(" nocase
        $uaf2 = "delete" nocase
        $uaf3 = "deref" nocase
        $check = "*ptr" nocase

    condition:
        any of ($uaf*) and $check
}

rule Vulnerability_SQL_Injection {
    meta:
        description = "Detects SQL injection vulnerability patterns"
        severity = "high"

    strings:
        $sql1 = "SELECT * FROM" nocase
        $sql2 = "INSERT INTO" nocase
        $sql3 = "DROP TABLE" nocase
        $sq_quote = "' OR '1'='1" nocase

    condition:
        any of them
}

rule Vulnerability_Format_String {
    meta:
        description = "Detects format string vulnerability patterns"
        severity = "high"

    strings:
        $fmt1 = "printf(" nocase
        $fmt2 = "%x" nocase
        $fmt3 = "%n" nocase
        $fmt4 = "sprintf(" nocase

    condition:
        all of them
}

rule Vulnerability_Integer_Overflow {
    meta:
        description = "Detects integer overflow patterns"
        severity = "high"

    strings:
        $int1 = "INT_MAX" nocase
        $int2 = "0xFFFFFFFF" nocase
        $int3 = "UINT_MAX" nocase
        $check = ">" nocase or "<" nocase

    condition:
        any of ($int*) and $check
}

rule Vulnerability_Null_Pointer_Dereference {
    meta:
        description = "Detects null pointer dereference patterns"
        severity = "high"

    strings:
        $null1 = "nullptr" nocase
        $null2 = "NULL" nocase
        $deref = "->" nocase or "*" nocase

    condition:
        any of ($null*) and $deref
}

rule Vulnerability_Command_Injection {
    meta:
        description = "Detects command injection vulnerability"
        severity = "high"

    strings:
        $cmd1 = "system(" nocase
        $cmd2 = "popen(" nocase
        $cmd3 = "exec(" nocase
        $shell_meta = ";" nocase or "|" nocase or "&" nocase

    condition:
        any of ($cmd*) and $shell_meta
}